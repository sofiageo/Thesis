\chapter{Γενικές παρατηρήσεις}

\section{Παράλληλος υπολογισμός}
Για 30 χρόνια, ένας από τους πιο σημαντικούς τρόπους για να βελτιώσουμε την απόδοση των υπολογιστικών συσκευών των καταναλωτών ήταν η αύξηση της ταχύτητας στην οποία λειτουργεί το ρολόι ενός επεξεργαστή. Ξεκινώντας από περίπου το 1MHZ το 1980, οι περισσότεροι σύγχρονοι επεξεργαστές έχουν ταχύτητες μεταξύ 1GHz και 4GHz, δηλαδή είναι περίπου 1000 φορές πιο γρήγοροι. Αν και δεν είναι ο μόνος τρόπος με τον οποίο έχουν βελτιωθεί οι επεξεργαστές, αποτελεί συνήθως μια αξιόπιστη πηγή για αύξηση της απόδοσης.

Τα τελευταία χρόνια όμως, οι κατασκευαστές έχουν αναγκαστεί να ψάξουν για εναλλακτικούς τρόπους αύξησης της υπολογιστικής δύναμης. Εξ αιτίας διάφορων περιορισμών στην κατασκευή ενσωματωμένων κυκλωμάτων, δεν είναι πλέον εύκολο να αυξάνουμε την ταχύτητα του ρολογιού του επεξεργαστή σαν τρόπο αύξησης της απόδοσης στις υπάρχουσες αρχιτεκτονικές. Στην αναζήτηση για επιπλέον υπολογιστική δύναμη για τους προσωπικούς επεξεργαστές, οι ερευνητές χρησιμοποίησαν τεχνολογίες που ήταν ήδη γνωστές από τους υπερ-υπολογιστές, στους οποίους είναι σύνηθες φαινόμενο να αποτελούνται από δεκάδες ή εκατοντάδες επεξεργαστές, οι οποίοι εκτελούν παράλληλες διεργασίες. Έτσι το 2005, οι κύριοι κατασκευαστές επεξεργαστών άρχισαν να προσφέρουν επεξεργαστές με δύο πυρήνες αντί για έναν. 

Τα επόμενα χρόνια, ακολούθησαν υλοποιήσεις με τρεις,τέσσερις,έξι, ακόμα και οκτώ πυρήνες. Έχει ξεκινήσει ήδη μια μεγάλη στροφή της βιομηχανίας υπολογιστών στον παράλληλο υπολογισμό. Με την κυκλοφορία των διπύρηνων μέχρι και 8 ή 16 πυρήνων επεξεργαστών για σταθμούς εργασίας, ο παράλληλος υπολογισμός δεν είναι πλέον υπόθεση που αφορά μόνο τους εξωτικούς υπερ-υπολογιστές. Επίσης οι φορητές συσκευές όπως κινητά τηλέφωνα και φορητές συσκευές μουσικής έχουν αρχίσει να ενσωματώνουν δυνατότητες παράλληλου υπολογισμού σε μια προσπάθεια να προσφέρουν δυνατότητες πολύ ανώτερες από τους προγόνους τους. Όλο και περισσότερο, οι προγραμματιστές λογισμικού πρέπει να εξοικειωθούν με πλατφόρμες και τεχνολογίες παράλληλου υπολογισμού ώστε να προμηθεύουν με πλούσιες εμπειρίες την βάση των χρηστών τους. Το μέλλον αποτελείται από πολύ-νηματικές εφαρμογές, και από φορητές συσκευές που μπορούν ταυτόχρονα να παίζουν μουσική, να εξερευνούν το διαδίκτυο, και να παρέχουν GPS υπηρεσίες.\cite{gpgpu-3}
\section{GPU Computing}

Η επιτάχυνση υπολογισμού γενικού σκοπού από μονάδες επεξεργασίας γραφικών, είναι η χρήση των GPUs μαζί με χρήση CPUs για να επιταχύνουν επιστημονικές, αναλυτικές, κατασκευαστικές, καταναλωτικές, και εμπορικές εφαρμογές. Από την πρώτη εμφάνιση της τεχνολογίας το 2007 από την NVIDIA, οι επιταχυντές GPU τώρα βρίσκονται σε κέντρα δεδομένων σε εργαστήρια αποδοτικής ενέργειας για λογαριασμό κυβερνήσεων, πανεπιστήμια, και μικρές και μεγάλες επιχειρήσεις σε όλον τον κόσμο. Οι GPUs επιταχύνουν εφαρμογές σε πλατφόρμες που εκτείνονται από αυτοκίνητα, σε κινητά τηλέφωνα, σε drones και ρομπότ.

Η επιτάχυνση μέσω μονάδων επεξεργασίας γραφικών παρέχει πρωτοφανή αποτελέσματα επιδόσεων διαχωρίζοντας και φορτώνοντας τις εντολές εντατικών υπολογισμών στην GPU, ενώ διατηρεί την εκτέλεση του υπόλοιπου κώδικα στην CPU. Από την οπτική γωνία του χρήστη, οι εφαρμογές απλώς τρέχουν πιο γρήγορα. H επιτάχυνση εφαρμογών με χρήση GPU ξεκίνησε με την εμφάνιση των shader και την υποστήριξη αριθμών με υποδιαστολή στις μονάδες επεξεργασίας γραφικών. Ένας από τους πρώτους κώδικες που εκτελέστηκε γρηγορότερα σε GPU από ότι σε CPU είναι η υλοποίηση τού αλγορίθμου LU Factorization (2005).

Αυτές οι πρώτες προσπάθειες για χρήση GPU σαν επεξεργαστή γενικού σκοπού απαιτούσαν μετατροπή των υπολογιστικών προβλημάτων σε μορφή στοιχείων γραφικών, που υποστηρίζονταν από το OpenGL ή το DirectX. Το κόστος μετατροπής ήταν πολύ μεγάλο. Στα επόμενα κεφάλαια θα μελετήσουμε τις υλοποιήσεις που ακολούθησαν, οι οποίες επέτρεψαν στους προγραμματιστές να αγνοήσουν το επίπεδο των γραφικών και να ασχοληθούν με ένα περιβάλλον προγραμματισμού υψηλής απόδοσης.

\begin{figure}[h]
\centering
\includegraphics[scale=1]{gpuintro1}
\caption{Εκτέλεση κώδικα σε CPU και GPU}
\end{figure}

\section{Διαφορές CPUs και GPUs}

Ένας απλός τρόπος για να κατανοήσουμε την διαφορά ανάμεσα σε μια CPU και μια GPU είναι να συγκρίνουμε πως αυτές επεξεργάζονται τις διεργασίες. Μια CPU αποτελείται από μερικούς πυρήνες βελτιστοποιημένους για σειριακή επεξεργασία ακολουθίας(sequential serial processing), ενώ μια GPU έχει μια ογκώδη παράλληλη αρχιτεκτονική που αποτελείται από χιλιάδες μικρότερους, πιο αποδοτικούς πυρήνες σχεδιασμένους για χειρισμό πολλαπλών διαδικασιών ταυτόχρονα.

\begin{figure}[h]
\centering
\includegraphics[scale=1]{cpuvsgpu1}
\caption{Πυρήνες σε CPU και GPU αντίστοιχα}
\end{figure}

Οι GPUs έχουν δημιουργηθεί για πολύ συγκεκριμένες χρήσεις, για παράδειγμα η απεικόνιση γραφικών, πολλαπλασιασμούς πυκνού πλέγματος, απλά φίλτρα επεξεργασίας, κ.α. Είναι πολύ καλές στην διαχείριση μεγάλων καθυστερήσεων γιατί είναι σχεδιασμένες με τρόπο ώστε να ανέχονται καθυστερήσεις υφών, μια διαδικασία 1000+ κύκλων. Οι πυρήνες GPU διαθέτουν πολλά νήματα: όταν ένα νήμα εκτελέσει μια διεργασία υψηλής καθυστέρησης, (για παράδειγμα μια προσπέλαση μνήμης), αυτό το νήμα τίθεται σε αναμονή (ενώ τα υπόλοιπα νήματα συνεχίζουν να εργάζονται), έως ότου η διαδικασία τελειώσει. Αυτό επιτρέπει στις GPUs να διατηρούν τις μονάδες υπολογισμού απασχολημένες περισσότερο από ότι οι παραδοσιακοί πυρήνες.

Οι GPUs δεν αποδίδουν στον χειρισμό διακλαδώσεων, γιατί συνήθως δημιουργούν δεσμίδες από νήματα σε στημόνι, και τα αποστέλλουν στην γραμμή σωλήνα για λόγους οικονομίας εντολών προσπέλασης/αποκωδικοποίησης. Αν τα νήματα συναντήσουν κάποια διακλάδωση, μπορεί να αποκλίνουν, π.χ 2 νήματα σε ένα στημόνι 8 νημάτων μπορεί να ακολουθήσουν την διακλάδωση, ενώ τα άλλα 6 μπορεί να μην την ακολουθήσουν. Τώρα το στημόνι έχει διαιρεθεί σε δύο στημόνια μεγέθους 2 και 6, τα οποία δεν θα εκτελούνται αποδοτικά. Το στημόνι των 2 νημάτων θα εκτελείται με 25\% απόδοση, και το στημόνι των 6 νημάτων θα εκτελείται με 75\% απόδοση. Μπορούμε να φανταστούμε ότι αν μια μονάδα επεξεργασίας συνεχίσει να συναντά επιπλέον διακλαδώσεις, η απόδοση τους συνεχίζει να μειώνεται. Για αυτόν τον λόγο, οι GPUs δεν είναι καλή επιλογή για τον χειρισμό διακλαδώσεων και ο κώδικας που περιέχει αυτές θα πρέπει να εκτελείται στις CPUs.

Γενικότερα, ο κώδικας που δεν θα πρέπει να εκτελείται σε GPUs είναι κώδικας με λίγο παραλληλισμό ή κώδικας με πολλές διακλαδώσεις ή συγχρονισμό, για παράδειγμα βάσεις δεδομένων, λειτουργικά συστήματα, αλγόριθμοι γραφημάτων, κ.α.
\subsection{Διαφορές προγραμματιστικού μοντέλου}
Οι πιο σημαντικές διαφορές στο προγραμματιστικό μοντέλο των GPUs είναι ότι δεν υποστηρίζουν διακοπές και εξαιρέσεις. Εκτός από αυτό, δεν υπάρχουν μεγάλες διαφορές μεταξύ της CUDA,OpenCL, και C. Επίσης όπως αναφέραμε, ο κώδικας θα πρέπει να γράφεται με όσο το δυνατόν λιγότερες διακλαδώσεις και συνεχή επικοινωνία μεταξύ των νημάτων.

Πολλά προβλήματα στον πραγματικό κόσμο έχουν πολλές διακλαδώσεις και παρατυπίες. Αλγόριθμοι γραφημάτων, λειτουργικά συστήματα, web browsers, κ.α. Ακόμα και τα γραφικά χρησιμοποιούν όλο και περισσότερο διακλαδώσεις και διαδικασίες γενικού σκοπού, αναγκάζοντας έτσι τις GPUs να γίνονται όλο και περισσότερο προγραμματιζόμενες.


\subsection{Ανάγκη χώρου}
Ο πιο σωστός τρόπος για να δούμε την επίδραση του GPGPU είναι να μελετήσουμε τους υπερ-υπολογιστές. Τα μεγάλα ερευνητικά κέντρα (Πανεπιστήμια, Εταιρίες, Κυβερνήσεις) χρειάζονται πολύ μεγάλη υπολογιστική δύναμη για να λύσουν τα πιο δύσκολα υπολογιστικά προβλήματα. Όσο μεγαλύτερο το πρόβλημα, τόσο μεγαλύτερος ο υπολογιστής που χρειάζεται. Παραδείγματα χρήσεων αυτών των υπολογιστών είναι οι διπλώσεις βιομοριακών πρωτεϊνών, η εξομοίωση εκρήξεων και πυρηνικών όπλων, αλλά και οικονομικές συναλλαγές που χρειάζονται για την διακίνηση χρήματος σε όλον τον κόσμο.

Αυτοί οι υπολογιστές συνήθως είναι μεγάλοι, τόσο σε φυσικό μέγεθος όσο και σε υπολογιστικές δυνατότητες. Για παράδειγμα ο TACC Ranger:
\begin{itemize}
\item Αριθμός Κόμβων: 3,936
\item Αριθμός πυρήνων: 62,976
\item Μέγιστη απόδοση: 579.4 TFlops
\item Αριθμός ραφιών: 82
\end{itemize}

Έτσι σε 82 μονάδες έχουμε 580 TFlops υπολογιστικής απόδοσης. Σχετικά με το ίδιο παράδειγμα με χρήση NVIDIA Tesla μονάδων έχουμε
\begin{itemize}
\item 1 Μονάδα Tesla S1070: 4 TFlops
\item 145 μονάδες: 580 TFlops
\item Μονάδες σε 1 ράφι: 42
\item Αριθμός ραφιών: 3.5
\end{itemize}
Δηλαδή για να έχουμε την ίδια απόδοση με την χρήση NVIDIA Tesla μονάδων θα χρειαστούμε το 1/10 του χώρου.

\section{Συμπλέγματα GPU}

\subsection{VirtualCL}
\subsubsection{Επισκόπηση}
Η πλατφόρμα VirtualCL είναι ένα περικάλυμμα για το OpenCL που επιτρέπει τις περισσότερες εφαρμογές να εκμεταλλεύονται με διαφάνεια πολλές OpenCL συσκευές σε ένα σύμπλεγμα, σαν αυτές να βρίσκονταν σε έναν προσωπικό υπολογιστή. Με την πλατφόρμα VirtualCL, οι απομακρυσμένοι κόμβοι εκτελούν διεργασίες για λογαριασμό των προγραμμάτων του ξενιστή.\cite{virtualcl-6}

Το VCL είναι ευέλικτο. Οι εφαρμογές μπορούν να δημιουργήσουν περιεχόμενο OpenCL που αποτελείται από συσκευές από διάφορους κόμβους, ή πολλά περιεχόμενα, κάθε ένα αποτελούμενο από τις συσκευές διαφορετικού κόμβου. Ή οποιονδήποτε συνδυασμό από τα παραπάνω. Άλλες εφαρμογές μπορούν να διαχωριστούν σε διάφορες ανεξάρτητες διεργασίες και νήματα, κάθε μία από τις οποίες εκτελείται σε διαφορετικό σύνολο συσκευών, ενώ ταυτόχρονα χρησιμοποιούν την κοινή μνήμη του συστήματος. 

Πιο εξελιγμένες εφαρμογές μπορούν να επιλέγουν τις συσκευές που θα εκτελούν τις διεργασίες τους, όμως το VCL επιτρέπει μεταβλητές συστήματος στις οποίες ορίζονται πολιτικές για τον διαμοιρασμό των συσκευών. Η αρχική ρύθμιση, είναι κάθε περιεχόμενο που δημιουργείται να περιέχει όλες τις συσκευές ενός κόμβου. Το VCL αποτελείται από τρία μέρη, την βιβλιοθήκη VCL, τον μεσίτη, και τον back-end δαίμονα. \cite{virtualcl-1}

\begin{figure}[h]
	\includegraphics[width=\linewidth]{gpu-cluster}
	\centering
	\caption{Ένα σύμπλεγμα από υπολογιστικούς κόμβους GPU}
\end{figure}

\subsubsection{Βιβλιοθήκη}
Η βιβλιοθήκη VCL είναι μια βιτρίνα συμπλέγματος για τις εφαρμογές OpenCL. Όταν συνδεθεί με τις εφαρμογές OpenCL, επιτρέπει πρόσβαση με διαφάνεια σε συσκευές OpenCL του συμπλέγματος, κρύβοντας την πραγματική τοποθεσία των συσκευών από τις εφαρμογές που τις καλούν. Η βιβλιοθήκη VCL είναι σχεδιασμένη να εκτελείται με τις περισσότερες εφαρμογές χωρίς επιπλέον παρεμβάσεις, έτσι μπορούμε να επιλέξουμε τον τρόπο που θα χρησιμοποιούνται οι συσκευές στο σύμπλεγμα, μέσω μεταβλητών συστήματος. Η βιβλιοθήκη VCL υποστηρίζει απόλυτα πολυ-νηματικό προγραμματισμό και παρέχει ασφάλεια νημάτων.\cite{virtualcl-2}

Η VCL βιβλιοθήκη χρησιμοποιεί διάφορους αλγόριθμους βελτιστοποίησης. Για παράδειγμα, λόγω της καθυστέρησης δικτύου, η βιβλιοθήκη προσπαθεί να βελτιστοποιήσει την απόδοση της επικοινωνίας διατηρώντας μια ανεξάρτητη βάση δεδομένων από αντικείμενα OpenCL και εκτελεί όσες λειτουργίες είναι δυνατόν στον υπολογιστή-ξενιστή, ώστε να ελαττώσει τον αριθμό των επικοινωνιών στο ελάχιστο.\cite{virtualcl-3}
\subsubsection{Μεσίτης (Broker)}
Ο μεσίτης (broker) είναι μια λειτουργία δαίμονα που εκτελείται σε κάθε υπολογιστή-ξενιστή όπου οι χρήστες μπορούν να εκτελέσουν τις OpenCL εφαρμογές τους. Ο μεσίτης συνδέεται με την βιβλιοθήκη VCL μέσω υποδοχών UNIX. Η ευθύνη του περιέχει:
\begin{enumerate}
\item Παρακολούθηση της λειτουργικότητας και διαθεσιμότητας των συσκευών στο σύμπλεγμα.
\item Αναφορά αυτών των συσκευών στις εφαρμογές που τις ζητάνε.
\item Έξυπνη κατανομή των συσκευών για τις εφαρμογές OpenCL όταν γίνεται δημιουργία περιεχομένου, για παράδειγμα η προσπάθεια να ταιριάξει ο αριθμός των συσκευών με τον αριθμό τον κόμβων που έχουν σύνολο τον αριθμό που ζητήθηκε απο την εφαρμογή.
\item Πιστοποίηση αυθεντικότητας, δρομολόγηση, και εξασφάλιση της ποιότητας των μηνυμάτων μεταξύ των εφαρμογών. 
\end{enumerate}

\subsubsection{Back-end Δαίμονας}
Η υπηρεσία του back-end δαίμονα εκτελείται σε κάθε κόμβο συμπλέγματος όπου υπάρχουν συσκευές OpenCL και υποστηρίζονται από κατάλληλους οδηγούς. Ο δαίμονας χρησιμοποιεί οποιαδήποτε OpenCL βιβλιοθήκη είναι διαθέσιμη στους κόμβους για να εκτελέσει πυρήνες για λογαριασμό των εφαρμογών πελάτη.

Εξομοιώνει όλες τις διαδικασίες OpenCL όπως αυτές ζητούνται από την βιβλιοθήκη VirtualCL. Για λόγους ασφάλειας, όσο οι συσκευές GPU και οι οδηγοί δεν επιτρέπουν διαφανής προτίμηση, οι συσκευές OpenCL δεν κοινοποιούνται από το back-end στις υπόλοιπες εφαρμογές. Κάθε συσκευή κατανέμεται σε μόνο μια εφαρμογή κάθε στιγμή.\cite{virtualcl-4}


\subsubsection{Προβλήματα}
Όταν εκτελούμε πυρήνες OpenCL σε απομακρυσμένες συσκευές, η καθυστέρηση δικτύου είναι ο κύριος παράγοντας περιορισμού. Η ελαχιστοποίηση του αριθμού των "ταξιδιών" για βασικές λειτουργίες OpenCL είναι το πρώτο βήμα για να αντιμετωπίσουμε αυτό το πρόβλημα.

Γιαυτό αναπτύχθηκε το SuperCL, όπου μια σειρά απο πυρήνες και λειτουργίες μνήμης αποστέλλονται στις συσκευές ενός κόμβου συμπλέγματος, συνήθως μόνο σε ένα "ταξίδι". Όταν είναι απαραίτητο, επιτρέπεται η επικοινωνία με τον ξενιστή, αλλά με ασύγχρονο τρόπο, για να αποφευχθεί περαιτέρω καθυστέρηση. 

Το εύρος ζώνης συχνότητας είναι επίσης περιοριστικός παράγοντας όταν περιέχονται τεράστιες διεργασίες I/O, και αυτό αντιμετωπίζεται από το SuperCL επιτρέποντας την αρχικοποίηση των buffer από αρχεία back-end, και την αποθήκευση των αποτελεσμάτων σε αρχεία back-end.\cite{virtualcl-5}

\section{Συμπεράσματα}
Σε αυτό το κεφάλαιο μελετήσαμε τις σημαντικές διαφορές του υπολογισμού GPUs και CPUs, ενώ είδαμε και τον τρόπο με τον οποίο λειτουργεί ένα σύμπλεγμα μονάδων επεξεργασίας γραφικών. \\

Το συγκεκριμένο πρόβλημα είναι πολύ σημαντικό για εταιρίες που ασχολούνται με υπερ-υπολογιστές, καθώς η χρήση των GPUs με τον κατάλληλο προγραμματισμό, τους επιτρέπει να δημιουργήσουν υπολογιστικές λύσεις σε δύσκολα προβλήματα (π.χ μελέτες παγκόσμιου κλίματος ή ωκεανογραφικές μελέτες), οι οποίες μπορούν με την σειρά τους να ξεκλειδώσουν νέες δυνατότητες που θα επηρεάσουν την ανθρώπινη καθημερινότητα.\\

Ένα από τα πολλά πλεονεκτήματα της χρήσης GPUs για τους υπερ-υπολογιστές είναι η μικρότερη κατανάλωση ενέργειας και η ελευθέρωση μεγάλου όγκου χώρου, το οποίο μας επιτρέπει να προσθέσουμε επιπλέον υπολογιστική δύναμη με επιπλέον συσκευές. Οι υπερ-υπολογιστές είναι πολύ σημαντικοί για τις εταιρίες και άλλα ερευνητικά ιδρύματα τα οποία μελετούν φυσικά φαινόμενα, όπως η εξομοίωση της ανόδου της θερμοκρασίας και τις επιπτώσεις της στον πλανήτη.\\

Στο επόμενο κεφάλαιο θα δούμε τις σημαντικότερες υλοποιήσεις εφαρμογών σε διάφορα επιστημονικά πεδία, τον λόγο που χρειάζεται επιτάχυνση στην επίλυση των προβλημάτων αυτών, ενώ θα ερευνήσουμε εφαρμογές που παρουσιάζουν ιδιαίτερο ενδιαφέρον. Τέλος, θα δούμε το μέγεθος τις επιτάχυνσης που επιτυγχάνεται σε διάφορες εφαρμογές.