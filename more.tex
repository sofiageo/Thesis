\chapter{Περισσότερα}

\subsection{Διαφορές CPUs και GPUs}

Ένας απλός τρόπος για να κατανοήσουμε την διαφορά ανάμεσα σε μια CPU και μια GPU είναι να συγκρίνουμε πως αυτές επεξεργάζονται τις διεργασίες. Μια CPU αποτελείται από μερικούς πυρήνες βελτιστοποιημένους για σειριακή επεξεργασία σειράς, ενώ μια GPU έχει μια ογκώδης παράλληλη αρχιτεκτονική που αποτελείται από χιλιάδες μικρότερους, πιο αποδοτικούς πυρήνες σχεδιασμένους για χειρισμό πολλαπλών διαδικασιών ταυτόχρονα.

\begin{figure}[h]
\centering
\includegraphics[scale=1]{cpuvsgpu1}
\caption{Πυρήνες σε CPU και GPU αντίστοιχα}
\end{figure}

Οι GPUs έχουν δημιουργηθεί για πολύ συγκεκριμένες χρήσεις, για παράδειγμα η απεικόνιση γραφικών, πολλαπλασιασμούς πυκνού πλέγματος, απλά φίλτρα επεξεργασίας, κ.α. Είναι πολύ καλές στην διαχείριση μεγάλων καθυστερήσεων γιατί είναι σχεδιασμένες με τρόπο ώστε να ανέχονται καθυστερήσεις υφών, μια διαδικασία 1000+ κύκλων. Οι πυρήνες GPU διαθέτουν πολλά νήματα: όταν ένα νήμα εκτελέσει μια διεργασία υψηλής καθυστέρησης, (για παράδειγμα μια προσπέλαση μνήμης), αυτό το νήμα τίθεται σε αναμονή (ενώ τα υπόλοιπα νήματα συνεχίζουν να εργάζονται), έως ότου η διαδικασία τελειώσει. Αυτό επιτρέπει στις GPUs να διατηρούν τις μονάδες υπολογισμού απασχολημένες περισσότερο από ότι οι παραδοσιακοί πυρήνες.

Οι GPUs δεν αποδίδουν στον χειρισμό διακλαδώσεων, γιατί συνήθως δημιουργούν δεσμίδες από νήματα σε στημόνι, και τα αποστέλλουν στην γραμμή σωλήνα για λόγους οικονομίας εντολών προσπέλασης/αποκωδικοποίησης. Αν τα νήματα συναντήσουν κάποια διακλάδωση, μπορεί να αποκλίνουν, π.χ 2 νήματα σε ένα στημόνι 8 νημάτων μπορεί να ακολουθήσουν την διακλάδωση, ενώ τα άλλα 6 μπορεί να μην την ακολουθήσουν. Τώρα το στημόνι έχει διαιρεθεί σε δύο στημόνια μεγέθους 2 και 6, τα οποία δεν θα εκτελούνται αποδοτικά. Το στημόνι των 2 νημάτων θα εκτελείται με 25\% απόδοση, και το στημόνι των 6 νημάτων θα εκτελείται με 75\% απόδοση. Μπορούμε να φανταστούμε ότι αν μια μονάδα επεξεργασίας συνεχίσει να συναντά επιπλέον διακλαδώσεις, η απόδοση τους συνεχίζει να μειώνεται. Για αυτόν τον λόγο, οι GPUs δεν είναι καλή επιλογή για τον χειρισμό διακλαδώσεων και ο κώδικας που περιέχει αυτές θα πρέπει να εκτελείται στις CPUs.

Γενικότερα, ο κώδικας που δεν θα πρέπει να εκτελείται σε GPUs είναι κώδικας με λίγο παραλληλισμό ή κώδικας με πολλές διακλαδώσεις ή συγχρονισμό, για παράδειγμα βάσεις δεδομένων, λειτουργικά συστήματα, αλγόριθμοι γραφημάτων, κ.α.
\subsubsection{Διαφορές προγραμματιστικού μοντέλου}
Οι πιο σημαντικές διαφορές στο προγραμματιστικό μοντέλο των GPUs είναι ότι δεν υποστηρίζουν διακοπές και εξαιρέσεις. Εκτός από αυτό, δεν υπάρχουν μεγάλες διαφορές μεταξύ της CUDA,OpenCL, και C. Επίσης όπως αναφέραμε, ο κώδικας θα πρέπει να γράφεται με όσο το δυνατόν λιγότερες διακλαδώσεις και συνεχή επικοινωνία μεταξύ των νημάτων.

Πολλά προβλήματα στον πραγματικό κόσμο έχουν πολλές διακλαδώσεις και παρατυπίες. Αλγόριθμοι γραφημάτων, λειτουργικά συστήματα, web browsers, κ.α. Ακόμα και τα γραφικά χρησιμοποιούν όλο και περισσότερο διακλαδώσεις και διαδικασίες γενικού σκοπού, αναγκάζοντας έτσι τις GPUs να γίνονται όλο και περισσότερο προγραμματιζόμενες.


\subsubsection{Ανάγκη χώρου}
Ο πιο σωστός τρόπος για να δούμε την επίδραση του GPGPU είναι να μελετήσουμε τους υπερ-υπολογιστές. Τα μεγάλα ερευνητικά κέντρα (Πανεπιστήμια, Εταιρίες, Κυβερνήσεις) χρειάζονται πολύ μεγάλη υπολογιστική δύναμη για να λύσουν τα πιο δύσκολα υπολογιστικά προβλήματα. Όσο μεγαλύτερο το πρόβλημα, τόσο μεγαλύτερος ο υπολογιστής που χρειάζεται. Παραδείγματα χρήσεων αυτών των υπολογιστών είναι οι διπλώσεις βιομοριακών πρωτεϊνών, η εξομοίωση εκρήξεων και πυρηνικών όπλων, αλλά και οικονομικές συναλλαγές που χρειάζονται για την διακίνηση χρήματος σε όλον τον κόσμο.

Αυτοί οι υπολογιστές συνήθως είναι μεγάλοι, τόσο σε φυσικό μέγεθος όσο και σε υπολογιστικές δυνατότητες. Για παράδειγμα ο TACC Ranger:
\begin{itemize}
\item Αριθμός Κόμβων: 3,936
\item Αριθμός πυρήνων: 62,976
\item Μέγιστη απόδοση: 579.4 TFlops
\item Αριθμός ραφιών: 82
\end{itemize}

Έτσι σε 82 μονάδες έχουμε 580 TFlops υπολογιστικής απόδοσης. Σχετικά με το ίδιο παράδειγμα με χρήση NVIDIA Tesla μονάδων έχουμε
\begin{itemize}
\item 1 Μονάδα Tesla S1070: 4 TFlops
\item 145 μονάδες: 580 TFlops
\item Μονάδες σε 1 ράφι: 42
\item Αριθμός ραφιών: 3.5
\end{itemize}
Δηλαδή για να έχουμε την ίδια απόδοση με την χρήση NVIDIA Tesla μονάδων θα χρειαστούμε το 1/10 του χώρου.

\section{Συμπλέγματα GPU}

\subsection{VirtualCL}
\subsubsection{Επισκόπηση}
Η πλατφόρμα VirtualCL είναι ένα περικάλυμμα για το OpenCL που επιτρέπει τις περισσότερες εφαρμογές να εκμεταλλεύονται με διαφάνεια πολλές OpenCL συσκευές σε ένα σύμπλεγμα, σαν αυτές να βρίσκονταν σε έναν προσωπικό υπολογιστή. Με την πλατφόρμα VirtualCL, οι απομακρυσμένοι κόμβοι εκτελούν διεργασίες για λογαριασμό των προγραμμάτων του ξενιστή.

Το VCL είναι ευέλικτο. Οι εφαρμογές μπορούν να δημιουργήσουν περιεχόμενο OpenCL που αποτελείται από συσκευές από διάφορους κόμβους, ή πολλά περιεχόμενα, κάθε ένα αποτελούμενο από τις συσκευές διαφορετικού κόμβου. Ή οποιονδήποτε συνδυασμό από τα παραπάνω. Άλλες εφαρμογές μπορούν να διαχωριστούν σε διάφορες ανεξάρτητες διεργασίες και νήματα, κάθε μία από τις οποίες εκτελείται σε διαφορετικό σύνολο συσκευών, ενώ ταυτόχρονα χρησιμοποιούν την κοινή μνήμη του συστήματος. 

Πιο εξελιγμένες εφαρμογές μπορούν να επιλέγουν τις συσκευές που θα εκτελούν τις διεργασίες τους, όμως το VCL επιτρέπει μεταβλητές συστήματος στις οποίες ορίζονται πολιτικές για τον διαμοιρασμό των συσκευών. Η αρχική ρύθμιση, είναι κάθε περιεχόμενο που δημιουργείται να περιέχει όλες τις συσκευές ενός κόμβου. Το VCL αποτελείται από τρία μέρη, την βιβλιοθήκη VCL, τον μεσίτη, και τον back-end δαίμονα. 
\subsubsection{Βιβλιοθήκη}
Η βιβλιοθήκη VCL είναι μια βιτρίνα συμπλέγματος για τις εφαρμογές OpenCL. Όταν συνδεθεί με τις εφαρμογές OpenCL, επιτρέπει πρόσβαση με διαφάνεια σε συσκευές OpenCL του συμπλέγματος, κρύβοντας την πραγματική τοποθεσία των συσκευών από τις εφαρμογές που τις καλούν. Η βιβλιοθήκη VCL είναι σχεδιασμένη να εκτελείται με τις περισσότερες εφαρμογές χωρίς επιπλέον παρεμβάσεις, έτσι μπορούμε να επιλέξουμε τον τρόπο που θα χρησιμοποιούνται οι συσκευές στο σύμπλεγμα, μέσω μεταβλητών συστήματος. Η βιβλιοθήκη VCL υποστηρίζει απόλυτα πολυ-νηματικό προγραμματισμό και παρέχει ασφάλεια νημάτων.

Η VCL βιβλιοθήκη χρησιμοποιεί διάφορους αλγόριθμους βελτιστοποίησης. Για παράδειγμα, λόγω της καθυστέρησης δικτύου, η βιβλιοθήκη προσπαθεί να βελτιστοποιήσει την απόδοση της επικοινωνίας διατηρώντας μια ανεξάρτητη βάση δεδομένων από αντικείμενα OpenCL και εκτελεί όσες λειτουργίες είναι δυνατόν στον υπολογιστή-ξενιστή, ώστε να ελαττώσει τον αριθμό των επικοινωνιών στο ελάχιστο.
\subsubsection{Μεσίτης}
Ο μεσίτης είναι μια λειτουργία δαίμονα που εκτελείται σε κάθε υπολογιστή-ξενιστή όπου οι χρήστες μπορούν να εκτελέσουν τις OpenCL εφαρμογές τους. Ο μεσίτης συνδέεται με την βιβλιοθήκη VCL μέσω υποδοχών UNIX. Η ευθύνη του περιέχει:
\begin{enumerate}
\item Παρακολούθηση της λειτουργικότητας και διαθεσιμότητας των συσκευών στο σύμπλεγμα.
\item Αναφορά αυτών των συσκευών στις εφαρμογές που τις ζητάνε.
\item Έξυπνη κατανομή των συσκευών για τις εφαρμογές OpenCL όταν γίνεται δημιουργία περιεχομένου, για παράδειγμα η προσπάθεια να ταιριάξει ο αριθμός των συσκευών με τον αριθμό τον κόμβων που έχουν σύνολο τον αριθμό που ζητήθηκε απο την εφαρμογή.
\item Πιστοποίηση αυθεντικότητας, δρομολόγηση, και εξασφάλιση της ποιότητας των μηνυμάτων μεταξύ των εφαρμογών. 
\end{enumerate}


